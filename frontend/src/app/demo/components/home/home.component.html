<p-toast />
<p-confirmDialog />
<div class="flex flex-col sm:flex-row items-center gap-6 mb-4">
    <div class="flex flex-col sm:flex-row gap-4">
        <img alt="avatar" [src]="condoInfo.avatar" class="avatarOwnerProfile" />
        <div>
            <span
                class="text-surface-900 dark:text-surface-0 font-bold text-4xl"
                style="color: black"
                >{{ condoInfo.type + ": " + condoInfo.alias | titlecase }}

                <div style="font-size: 12px">
                    Billing date:
                    {{ condoInfo.paymentDate }}
                </div>
            </span>
        </div>
        <span
            class="pi pi-cog"
            (click)="settings()"
            style="cursor: pointer"
        ></span>
    </div>
    <p-tag
        [severity]="condoInfo.status == 'active' ? 'success' : 'danger'"
        [value]="condoInfo.status == 'active' ? 'Active' : 'Deactive'"
    />
</div>
<div class="grid">
    <div class="col-12 lg:col-6 xl:col-3">
        <div class="card">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">
                        Total units
                    </span>
                    <div class="text-900 font-medium text-2xl">{{ units }}</div>
                </div>

                <div
                    class="flex align-items-center justify-content-center bg-blue-100 border-round icon-plus-changer"
                    (click)="showDialog()"
                    [ngStyle]="{ width: '2.5rem', height: '2.5rem' }"
                >
                    <i class="pi pi-plus text-blue-500 text-xl"></i>
                </div>
            </div>
            <span class="text-500">Member since: </span>
            <span class="text-green-500 font-medium"
                >{{ card_unit_member_date }}
            </span>
        </div>
    </div>

    <div class="col-12 lg:col-6 xl:col-3">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">
                        Bookings
                    </span>
                    <div class="text-900 font-medium text-2xl">
                        {{ totalBooked }}
                    </div>
                </div>
                <a
                    (click)="showComponent('booking')"
                    class="change-icon flex align-items-center justify-content-center bg-orange-100 border-round"
                    [ngStyle]="{ width: '2.5rem', height: '2.5rem' }"
                >
                    <i class="pi pi-calendar-minus text-orange-500 text-xl"></i>
                </a>
            </div>
            <span class="text-green-500 font-medium">%52+ </span>
            <span class="text-500">since last week</span>
        </div>
    </div>
    <div class="col-12 lg:col-6 xl:col-3">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3"
                        >Staff list</span
                    >
                    <div class="text-900 font-medium text-2xl">
                        {{ stafflistNumber }}
                    </div>
                </div>
                <a
                    (click)="showComponent('staff')"
                    class="flex align-items-center justify-content-center bg-cyan-100 border-round change-icon"
                    [ngStyle]="{ width: '2.5rem', height: '2.5rem' }"
                >
                    <i class="pi pi-users text-cyan-500 text-2xl"></i>
                </a>
            </div>
            <span class="text-green-500 font-medium"
                >{{ activeStaffQty }}
            </span>
            <span class="text-500">staff active</span>
        </div>
    </div>
    <div class="col-12 lg:col-6 xl:col-3">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3"
                        >Inquiries</span
                    >
                    <div class="text-900 font-medium text-2xl">
                        {{ totalInquiries }}
                    </div>
                </div>
                <div
                    class="flex align-items-center justify-content-center bg-purple-100 border-round"
                    [ngStyle]="{ width: '2.5rem', height: '2.5rem' }"
                >
                    <a
                        (click)="showComponent('inquiry')"
                        class="flex align-items-center justify-content-center bg-purple-100 border-round change-icon"
                        [ngStyle]="{ width: '2.5rem', height: '2.5rem' }"
                    >
                        <i class="pi pi-comment text-purple-500 text-xl"></i>
                    </a>
                </div>
            </div>
            <span class="text-green-500 font-medium">85 </span>
            <span class="text-500">responded</span>
        </div>
    </div>

    <div class="col-12 lg:col-6 xl:col-3">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3"
                        >Documents</span
                    >
                    <div class="text-900 font-medium text-2xl">
                        {{ totalDocuments }}
                    </div>
                </div>
                <div
                    class="flex align-items-center justify-content-center bg-grey-100 border-round"
                    [ngStyle]="{ width: '2.5rem', height: '2.5rem' }"
                >
                    <a
                        (click)="showComponent('documents')"
                        class="flex align-items-center justify-content-center bg-yellow-100 border-round change-icon"
                        [ngStyle]="{ width: '2.5rem', height: '2.5rem' }"
                    >
                        <i class="pi pi-folder text-orange-500 text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<p-breadcrumb class="max-w-full mb-4" [model]="itemsx" />
<div class="grid mt-2" *ngIf="componentsToShow.main">
    <div class="col-12 xl:col-6">
        <div class="card">
            <h5>Residents</h5>
            <p-table
                [value]="customers"
                [paginator]="true"
                [rows]="5"
                responsiveLayout="scroll"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th>Picture</th>
                        <th pSortableColumn="fullname">
                            Fullname
                            <p-sortIcon field="fullname"></p-sortIcon>
                        </th>
                        <th pSortableColumn="unit">
                            Unit <p-sortIcon field="unit"></p-sortIcon>
                        </th>
                        <th>View</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-customer>
                    <tr>
                        <td style="width: 15%; min-width: 5rem">
                            <img
                                src="{{
                                    url +
                                        'main-avatar/owners/' +
                                        customer.avatar
                                }}"
                                class="shadow-4"
                                alt=""
                                width="50"
                                style="border-radius: 5px"
                            />
                        </td>
                        <td style="width: 35%; min-width: 7rem">
                            {{
                                customer.name + " " + customer.lastname
                                    | titlecase
                            }}
                        </td>
                        <td style="width: 35%; min-width: 8rem">
                            {{ customer.condominium_unit }}
                        </td>
                        <td style="width: 15%">
                            <button
                                pButton
                                pRipple
                                type="button"
                                (click)="showOwnerDialog(customer)"
                                icon="pi pi-eye"
                                class="p-button p-component p-button-text p-button-icon-only"
                            ></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        <div class="card">
            <h5>Notifications</h5>
            <hr />
            <div *ngIf="areThereInquiries">
                <p>No inquiries found.</p>
            </div>
            <div class="notifications">
                <div
                    class="notification-item"
                    *ngFor="let inquiry of inquiries"
                >
                    <div class="notification-icon">
                        <i
                            class="pi pi-comment"
                            [ngClass]="{
                                'text-red-500':
                                    inquiry.status === 'high' ||
                                    inquiry.status === 'urgent',
                                'text-yellow-500': inquiry.status === 'medium',
                                'text-green-500': inquiry.status === 'low'
                            }"
                        ></i>
                        {{ inquiry.title }}
                    </div>
                    <div class="notification-content">
                        <div class="body-notification">
                            <span class="notification-text">
                                {{ inquiry.fullname }} has sent an inquiry.
                            </span>
                            <span
                                class="notification-status"
                                [ngClass]="{
                                    'status-high': inquiry.status === 'high',
                                    'status-medium':
                                        inquiry.status === 'medium',
                                    'status-low': inquiry.status === 'low'
                                }"
                                >{{ inquiry.status | titlecase }}</span
                            >
                        </div>
                        <p-button
                            icon="pi pi-eye"
                            [rounded]="true"
                            [text]="true"
                            (click)="showInquiryDialog(inquiry)"
                        ></p-button>
                    </div>
                    <hr />
                </div>
            </div>
        </div>
    </div>

    <div class="col-12 xl:col-6">
        <div class="card">
            <div class="d-flex">
                <p-inputGroup>
                    <div
                        class="flex align-items-center justify-content-center bg-gray-100 border-round icon-plus-changer mr-3"
                        (click)="showComponent('invoiceHistory')"
                        [ngStyle]="{ width: '2.5rem', height: '2.5rem' }"
                    >
                        <i class="pi pi-history text-gray-500 text-xl"></i>
                    </div>
                    <span class="alingText">Invoice history</span>

                    <div class="ml-3"></div>
                    <div
                        class="flex align-items-center justify-content-center bg-green-100 border-round icon-plus-changer mr-3"
                        (click)="showInvoiceGenerator()"
                        [ngStyle]="{ width: '2.5rem', height: '2.5rem' }"
                    >
                        <i class="pi pi-money-bill text-green-500 text-xl"></i>
                    </div>
                    <span class="alingText">Invoice generator</span>
                </p-inputGroup>
            </div>

            <div class="divider"></div>

            <h5>Monthly Payment</h5>
            <p-progressSpinner *ngIf="!chartVisible" ariaLabel="loading" />
            <p-chart
                type="bar"
                *ngIf="chartVisible"
                [data]="dataChart"
                [options]="options"
            ></p-chart>
        </div>

        <!-- Modal owners details -->

        <p-dialog
            header="Resident Profile"
            [modal]="true"
            [(visible)]="visible_owner"
            [maximizable]="true"
            [style]="{ width: '100vw', height: '100vh' }"
            [contentStyle]="{ overflow: 'auto' }"
            (onHide)="closeDialog()"
        >
            <app-header-widget class="col-span-12">
                <div class="flex flex-col sm:flex-row items-center gap-6">
                    <div class="flex flex-col sm:flex-row items-center gap-4">
                        <img
                            alt="avatar"
                            [src]="ownerObj.avatar"
                            class="avatarOwnerProfile"
                        />
                        <div>
                            <span
                                class="text-surface-900 dark:text-surface-0 font-bold text-4xl"
                                style="color: black"
                                >{{
                                    ownerObj.name + " " + ownerObj.lastname
                                }}</span
                            >
                            <p
                                class="text-surface-600 dark:text-surface-200 m-0"
                            >
                                Last login was on 04/05/2022 at 10:24 am
                            </p>
                        </div>
                    </div>
                </div>
            </app-header-widget>
            <hr />
            <p-tabView>
                <p-tabPanel header="Basic info">
                    <app-owner-profile-settings
                        [ownerObj]="ownerObj"
                        *ngIf="visible_owner"
                        [isHome]="true"
                    >
                    </app-owner-profile-settings>
                </p-tabPanel>

                <p-tabPanel header="Properties">
                    <app-properties-by-owner
                        [ownerData]="ownerObj._id"
                        *ngIf="visible_owner"
                    ></app-properties-by-owner>
                </p-tabPanel>

                <p-tabPanel header="Authorized users">
                    <app-family-member-details
                        *ngIf="visible_owner"
                        [ownerIdInput]="ownerObj._id"
                    ></app-family-member-details>
                </p-tabPanel>

                <p-tabPanel header="Payments history">
                    <app-payments-history
                        *ngIf="visible_owner"
                        [ownerIdInput]="ownerObj._id"
                    ></app-payments-history>
                </p-tabPanel>
                <p-tabPanel header="Bookings">
                    <app-booking-area
                        [condoId]="condoId"
                        *ngIf="visible_owner"
                    ></app-booking-area>
                </p-tabPanel>
            </p-tabView>
        </p-dialog>
    </div>
</div>

<!--START MODAL-->
<p-dialog
    [(visible)]="visible"
    (onHide)="closeDialogRegistration()"
    [modal]="true"
    [maximizable]="true"
>
    <ng-template pTemplate="header">
        <span class="font-semibold text-xl w-100">
            <h2>Register owner</h2>
        </span>
        <hr />
    </ng-template>

    <p-tabView>
        <p-tabPanel header="Create single unit">
            <app-owner-registration *ngIf="visible"></app-owner-registration>
        </p-tabPanel>

        <p-tabPanel header="Create multiple units">
            <app-pool-file-loader
                *ngIf="visible"
                [service_key]="'ownersByFile'"
            ></app-pool-file-loader>
        </p-tabPanel>
    </p-tabView>
</p-dialog>

<!-- Invoice generater -->

<app-invice-generater
    [invoiceData]="invoiceInfo"
    (facturaGenerada)="procesarFactura($event)"
/>

<!-- Invoice History -->
<app-invoice-history
    [ownerId]="condoId"
    *ngIf="componentsToShow.invoiceHistory"
></app-invoice-history>

<!-- Bookings generater -->
<app-booking-area
    [condoId]="condoId"
    *ngIf="componentsToShow.booking"
></app-booking-area>
<!-- Bookings generater -->
<!-- Staff  -->
<app-staff
    *ngIf="componentsToShow.staff"
    [condoId]="condoId"
    [isHome]="true"
    (staffUpdated)="staffCard()"
></app-staff>

<!-- Notification -->

<app-inquiry
    *ngIf="componentsToShow.inquiry"
    [condoId]="condoId"
    [isHome]="true"
    [dataDialog]="inquiryDialogData"
    (clearSelectedInquiryDialog)="closeInquiryDialog($event)"
></app-inquiry>

<!-- Documents -->
<app-docs
    *ngIf="componentsToShow.documents"
    [isDashboard]="false"
    [userId]="condoId"
></app-docs>

<!-- Settings Dialog -->

<p-dialog
    header="Settings"
    [(visible)]="visible_settings"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [closable]="true"
    [style]="{ width: '30%' }"
>
    <form #condominiumForm="ngForm" (ngSubmit)="updateCondo()">
        <span class="p-text-secondary mb-3"
            >Update your condominium information.</span
        >
        <div class="d-block" style="padding: 12px">
            <div class="addressProperty">
                <label htmlFor="aliaslabel">Alias</label>
                <input
                    [ngClass]="{
                        'input-error':
                            alias.invalid && (alias.dirty || alias.touched)
                    }"
                    pInputText
                    #alias="ngModel"
                    name="alias"
                    [(ngModel)]="condoInfo.alias"
                    id="aliaslabel"
                    type="text"
                    maxlength="50"
                    required
                />
            </div>

            <div class="addressProperty">
                <label htmlFor="phone">Phone</label>
                <input
                    [ngClass]="{
                        'input-error':
                            phone.invalid && (phone.dirty || phone.touched)
                    }"
                    pInputText
                    #phone="ngModel"
                    [(ngModel)]="condoInfo.phone"
                    name="phone"
                    id="phone"
                    type="text"
                    maxlength="11"
                    pattern="^[0-9]+"
                    placeholder="8095882222"
                    required
                />
            </div>

            <div class="addressProperty">
                <label htmlFor="phone2">Phone 2</label>
                <input
                    pInputText
                    #phone2="ngModel"
                    [(ngModel)]="condoInfo.phone2"
                    name="phone2"
                    id="phone2"
                    type="text"
                    pattern="^[0-9]+"
                    maxlength="11"
                    pattern="^[0-9]+"
                    placeholder="8095882222"
                />
            </div>
            <div class="addressProperty">
                <label htmlFor="amountInvoiceLabel">Monthly Fee</label>
                <input
                    pInputText
                    type="text"
                    #amountInvoice="ngModel"
                    name="amountInvoice"
                    [(ngModel)]="condoInfo.mPayment"
                    id="amountInvoiceLabel"
                />
            </div>
            <div class="addressProperty">
                <label htmlFor="issueDateUpdatelabel">Payment Date</label>
                <div class="mt-2"></div>
                <p-calendar
                    #issueDateUpdate="ngModel"
                    name="issueDateUpdate"
                    [(ngModel)]="condoInfo.paymentDate"
                    id="issueDateUpdatelabel"
                    [inline]="true"
                    [showWeek]="true"
                />
            </div>
        </div>
        <div class="mt-4">
            <button
                class="btn-update-topbar"
                [disabled]="!condominiumForm.valid"
                pButton
                pRipple
                label="Update"
            ></button>
        </div>
    </form>
</p-dialog>
